I"÷#<h2>Kakao API [Refresh token]</h2>

<p>ì˜¤ëŠ˜ì€ <code class="language-plaintext highlighter-rouge">Refresh token</code>ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p>ì•„ì§ ì‚¬ìš©ì í† í°ì„ ë°›ì§€ ëª»í•˜ì‹  ë¶„ì€ <a href="/api/kakao_api_usertoken/">[Kakao API] ì‚¬ìš©ìí† í°</a> ì„ ì°¸ê³ í•˜ì—¬ ì‚¬ìš©ìí† í°ì„ ë¨¼ì € ë°›ê³  ì˜¤ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤. Refresh token í† í°ì€ ì‚¬ìš©ì í† í°ì„ ë°›ëŠ”ë°©ë²•ê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤.</p>

<h3>Refresh token ë°›ê¸°</h3>

<p>ì—¬ëŸ¬ë¶„ë“¤ì´ ì§ì ‘ ì¹´ì¹´ì˜¤ì— ìˆëŠ” ì‚¬ìš©ë²•ì„ ë³´ê³  ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p>ë¨¼ì € refresh í† í°ì„ ë°œê¸‰ë°›ê¸° ìœ„í•´ <a href="https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api">ì‚¬ìš©ì í† í° ê°±ì‹ í•˜ê¸°</a> í•­ëª©ì„ ì°¸ê³ í•©ë‹ˆë‹¤.</p>

<p><img src="../../assets/image/image-20200821203109199.png" alt="image-20200821203109199" /></p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">POST</span> <span class="nn">/oauth/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">kauth.kakao.com</span>
<span class="na">Content-type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded;charset=utf-8</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Access token</code> ì„ ë°›ëŠ” ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ í•˜ê¸° Requestì—ì„œ ì–´ë–¤ ê°’ì„ í•„ìˆ˜ë¡œ ì…ë ¥í•˜ì—¬ì•¼ í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>

<h3 id="request">Request</h3>

<h5 id="parameter">Parameter</h5>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Name</th>
      <th style="text-align: left">Type</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Required</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">grant_type</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">â€œrefresh_tokenâ€ìœ¼ë¡œ ê³ ì •</td>
      <td style="text-align: left">O</td>
    </tr>
    <tr>
      <td style="text-align: left">client_id</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">ì•± ìƒì„± ì‹œ ë°œê¸‰ ë°›ì€ REST API</td>
      <td style="text-align: left">O</td>
    </tr>
    <tr>
      <td style="text-align: left">refresh_token</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">í† í° ë°œê¸‰ ì‹œ ì‘ë‹µìœ¼ë¡œ ë°›ì€ refresh_token Access Tokenì„ ê°±ì‹ í•˜ê¸° ìœ„í•´ ì‚¬ìš©</td>
      <td style="text-align: left">O</td>
    </tr>
    <tr>
      <td style="text-align: left">client_secret</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">í† í° ë°œê¸‰ ì‹œ, ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ì¶”ê°€ í™•ì¸í•˜ëŠ” ì½”ë“œ [ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜] &gt; [ë³´ì•ˆ]ì—ì„œ ì„¤ì • ê°€ëŠ¥ ON ìƒíƒœì¸ ê²½ìš° í•„ìˆ˜ ì„¤ì •í•´ì•¼ í•¨</td>
      <td style="text-align: left">X</td>
    </tr>
  </tbody>
</table>

<p>ìƒê¸°ì˜ Request ë¥¼ ì •í™•íˆ í•˜ë©´ ì‘ë‹µìœ¼ë¡œ í•˜ê¸° ê°’ì„ ë°›ì„ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰ refresh tokenì„ ì…ë ¥í•˜ë©´ <code class="language-plaintext highlighter-rouge">access_token</code>ì´ ë³€ê²½ë˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.</p>

<h3 id="response">Response</h3>

<h5 id="key">Key</h5>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Name</th>
      <th style="text-align: left">Type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">token_type</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">í† í° íƒ€ì…, â€œbearerâ€ë¡œ ê³ ì •</td>
    </tr>
    <tr>
      <td style="text-align: left">access_token</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">ê°±ì‹ ëœ ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ í† í° ê°’</td>
    </tr>
    <tr>
      <td style="text-align: left">expires_in</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Integer</code></td>
      <td style="text-align: left">ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œ ì‹œê°„(ì´ˆ)</td>
    </tr>
    <tr>
      <td style="text-align: left">refresh_token</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">String</code></td>
      <td style="text-align: left">ê°±ì‹ ëœ ì‚¬ìš©ì ë¦¬í”„ë ˆì‹œ í† í° ê°’, ê¸°ì¡´ ë¦¬í”„ë ˆì‹œ í† í°ì˜ ìœ íš¨ê¸°ê°„ì´ 1ê°œì›” ë¯¸ë§Œì¸ ê²½ìš°ì—ë§Œ ê°±ì‹ </td>
    </tr>
    <tr>
      <td style="text-align: left">refresh_token_expires_in</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Integer</code></td>
      <td style="text-align: left">ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ ì‹œê°„(ì´ˆ)</td>
    </tr>
  </tbody>
</table>

<p>ë” ë°‘ìœ¼ë¡œ ë‚´ë ¤ë³´ë©´ <code class="language-plaintext highlighter-rouge">Sample Code</code>ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="sample">Sample</h3>

<h5 id="request-1">Request</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-v</span> <span class="nt">-X</span> POST https://kauth.kakao.com/oauth/token <span class="se">\</span>
 <span class="nt">-d</span> <span class="s1">'grant_type=refresh_token'</span> <span class="se">\</span>
 <span class="nt">-d</span> <span class="s1">'client_id={REST_API_KEY}'</span> <span class="se">\</span>
 <span class="nt">-d</span> <span class="s1">'refresh_token={USER_REFRESH_TOKEN}'</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Sample</code> ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ Pythonì—ì„œ ì‘ì—…ì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p>Access token (usertoken) ì€ <a href="/api/kakao_api_usertoken/">[Kakao API] ì‚¬ìš©ìí† í°</a> ì—ì„œ ì €ì¥í•œ json íŒŒì¼ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"kakao_token.json"</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="c1"># json ë¶ˆëŸ¬ì˜¤ê¸°
</span>
<span class="k">print</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"https://kauth.kakao.com/oauth/token"</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"grant_type"</span>     <span class="p">:</span> <span class="s">"refresh_token"</span><span class="p">,</span>
    <span class="s">"client_id"</span>      <span class="p">:</span> <span class="n">app_key</span><span class="p">,</span>
    <span class="s">"refresh_token"</span>  <span class="p">:</span> <span class="n">tokens</span><span class="p">[</span><span class="s">'refresh_token'</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1">#
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">status_code</span>
<span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">tokens</span><span class="p">[</span><span class="s">'access_token'</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'access_token'</span><span class="p">]</span>
<span class="n">tokens</span><span class="p">[</span><span class="s">'app_key'</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_key</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"kakao_token.json"</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="c1"># ì €ì¥í•˜ëŠ” ê²ƒ
</span></code></pre></div></div>

:ET