I"é6<h2 id="cnn-convolutional-neural-network">CNN (Convolutional Neural Network)</h2>

<p>ì´ë²ˆì‹œê°„ì—ëŠ” <code class="language-plaintext highlighter-rouge">CNN</code>ì— ëŒ€í•˜ì—¬ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. CNN ì€ í•©ì„±ê³± ì‹ ê²½ë§ìœ¼ë¡œì„œ ì´ë¯¸ì§€ì˜ íŠ¹ì§•ì„ ê²€ì¶œí•˜ì—¬ í•™ìŠµí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. DNNì˜ ê²½ìš° MNISTì—ì„œ ì´ë¯¸ì§€ë¥¼ íŒë‹¨í• ë•Œ íšŒì „ëœ ì´ë¯¸ì§€ì˜ ëŒ€í•œ í•™ìŠµì´ ì—†ë‹¤ë©´ ë‹¤ë¥¸ ì´ë¯¸ì§€ë¡œ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ CNN ì˜ ê²½ìš° ì´ë¯¸ì§€ì˜ íŠ¹ì§•ì„ ê²€ì¶œí•˜ê¸° ì‹œê°„ê³¼ íš¨ìœ¨ì´ ì¢‹ìŠµë‹ˆë‹¤.</p>

<p>í•˜ê¸° ì´ë¯¸ì§€ë¥¼ ë³´ë©´ì„œ ì„¤ëª…ì„ í•´ë³´ë„ë¡í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p align="center"><img src="../../assets/image/1*XbuW8WuRrAY5pC4t-9DZAQ-20201023100830148.jpeg" alt="Understanding of Convolutional Neural Network (CNN) â€” Deep Learning | by  Prabhu | Medium" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19" /></p>

<p><em>Image credits : <a href="https://kr.mathworks.com/?s_tid=gn_logo">Mathworks</a></em></p>

<p align="center"><img src="../../assets/image/1595600945708.jpg" alt="Deep Learning Workflow" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19" /></p>

<p><em>Image credits : <a href="https://kr.mathworks.com/?s_tid=gn_logo">Mathworks</a></em></p>

<p>CNN ì€ Featureì— ëŒ€í•œ í•™ìŠµì„ ë¨¼ì € ì§„í–‰í•˜ê³  ë¶„ë¥˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. íŠ¹ì§•ì„ í•™ìŠµí•˜ê¸° ìœ„í•´ì„œ Filter ì™€ Convolution(í•©ì„±ê³±)ì„ ì§„í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<h3 id="convolution-í•©ì„±ê³±">Convolution (í•©ì„±ê³±)</h3>

<p>ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•˜ë©´ Filterì™€ í•©ì„±ê³±ì„ í†µí•´ì„œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="../../assets/image/image-20201023171607643.png" alt="image-20201023171607643" /></p>

<p>í•„í„°ëŠ” í•œê°œë§Œ ì¡´ì¬í•˜ì§€ ì•Šê³  ì—¬ëŸ¬ê°œê°€ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¯¸ì§€ í•˜ë‚˜ì—ì„œ ì—¬ëŸ¬ê°œì˜ Filterì™€ Convolutionì„ ì§„í–‰í•˜ë©´ Filterì˜ ê°œìˆ˜ë§Œí¼ ì¶œë ¥ì´ë¯¸ì§€ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="strides">Strides</h3>

<p>StridesëŠ” í•„í„°ê°€ ê³„ì‚°ê³¼ì •ì—ì„œ ì´ë™í•˜ëŠ” í¬ê¸°ì…ë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ (1,1) ì´ë©° (2,2), (3,3) ë“±ìœ¼ë¡œ ì„¤ì •í• ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ê¸° ê·¸ë¦¼ì€ Strides ë³€í™˜ì— ë”°ë¥¸ ì¶œë ¥ì´ë¯¸ì§€ì…ë‹ˆë‹¤.</p>

<p><img src="../../assets/image/image-20201023172659442.png" alt="image-20201023172659442" style="zoom:33%;" /></p>

<p align="center"><b>Strides = 1</b></p>

<p><img src="../../assets/image/image-20201023172647913.png" alt="image-20201023172647913" style="zoom:33%;" /></p>

<p align="center"><b>Strides = 2</b></p>

<h3 id="padding">Padding</h3>

<p>ìœ„ì—ì„œ í™•ì¸í•œë°”ì™€ ê°™ì´ í•„í„°ì™€ í•©ì„±ê³±ì„ ì§„í–‰í•˜ë©´ ì¶œë ¥ì´ë¯¸ì§€ì˜ í¬ê¸°ê°€ ì‘ì•„ì§€ê²Œ ë©ë‹ˆë‹¤. ì´ë¥¼ ë³´ìƒí•˜ê¸° ìœ„í•˜ì—¬ ë‚˜ì˜¨ ê°œë…ì´ Padding ì…ë‹ˆë‹¤. ì…ë ¥ë°ì´í„° ê°€ì¥ìë¦¬ì— ë¹ˆ ê°’ì„ ì±„ì›Œë„£ì–´ í–‰ë ¬ê³±ì„ ì—°ì‚°í•˜ëŠ” ë°©ì‹ì´ Padding ì´ë¼ê³  ë¶€ë¥´ë©° ê°€ì¥ìë¦¬ ê°’ì´ ëª¨ë‘ 0ìœ¼ë¡œ ì±„ì›Œì§„ ê²½ìš° Zero padding ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.</p>

<p align="center"><img src="../../assets/image/image-20201024232835532.png" alt="image-20201024232835532" style="zoom: 33%;" /></p>

<div align="center"><b>Zero padding</b></div>

<p>Padding ì—ëŠ” ë‘ê°€ì§€ ë°©ì‹ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p>

<blockquote>
  <p><strong>VALID</strong></p>

  <p>ì›ë³¸ì´ë¯¸ì§€ì— ë¹„í•´ ì¶œë ¥ì´ë¯¸ì§€ê°€ ì‘ì•„ì§€ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤. ë¹ˆê°’ì„ ì±„ì›Œë„£ì§€ ì•Šê³  í•©ì„±ê³±ì„ í•©ë‹ˆë‹¤.</p>

  <p><strong>Same</strong></p>

  <p>ë¹ˆê°’ì„ ë„£ì–´ ì›ë³¸ì´ë¯¸ì§€ì™€ ì¶œë ¥ì´ë¯¸ì§€ê°€ ë™ì¼í•œ í¬ê¸°ê°€ ë˜ë„ë¡ ë¹ˆê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
</blockquote>

<h4 id="ì´ë¯¸ì§€-í‘œí˜„">ì´ë¯¸ì§€ í‘œí˜„</h4>

<p>ì´ë¯¸ì§€ëŠ” ì„¸ê°€ì§€ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>binary : 0ê³¼ 1ë¡œí‘œí˜„</p>

  <p>gray scale : 0~255</p>

  <p>color image : RGB ì»¬ëŸ¬ë¡œ í‘œí˜„í•˜ë©° (0~255,0~255,0~255) ë¡œ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

  <p>PNG : color ì´ë¯¸ì§€ì—ì„œ (R,G,B Alpha) ë¡œ í‘œí˜„í•˜ë©° Alpha ëŠ” ì´ë¯¸ì§€ì˜ íˆ¬ëª…ë„ë¥¼ í‘œí˜„í•œë‹¤</p>
</blockquote>

<p>color image &gt; gray scale</p>
<ol>
  <li>(RGB í‰ê· , RGB í‰ê· , RGB í‰ê· )</li>
  <li>(RGB í‰ê· )</li>
</ol>

<p>PNG = (R,G,B Alpha) 
Alpha ëŠ” íˆ¬ëª…ë„ ì´ë¯¸ì§€ë¥¼ ë” ë‹¤ì–‘í•˜ê²Œ í‘œí˜„ ê°€ëŠ¥</p>

<p>ì½”ë“œë¡œ êµ¬í˜„ì„ í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">reset</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="n">img</span>

<span class="c1"># sub plotì„ 2ê°œ ë§Œë“¤ì–´ ë³´ì•„ìš”!
</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># ê°€ë¡œ 10ì¸ì¹˜, ì„¸ë¡œ 10ì¸ì¹˜
</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 1,2ëŠ” í–‰ê³¼ ì—´ì„ ì˜ë¯¸, ë§ˆì§€ë§‰ 1ì€ ê·¸ì¤‘ ëª‡ë²ˆì§¸ ì¸ì§€ë¥¼ ì˜ë¯¸
</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> 

<span class="n">ori_img</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'./images/Teddy.jpeg'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ori_img</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s">'ori_imgì˜ shape:{}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ori_img</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># convolution ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë ¤ë©´ 4ì°¨ì›ì´ í•„ìš”!
# ì´ë¯¸ì§€ê°€ 3ì°¨ì› + ê·¸ëŸ° ì´ë¯¸ì§€ê°€ ì—¬ëŸ¬ì¥ ì´ë‹ˆê¹Œ 4ì°¨ì›ìœ¼ë¡œ í‘œí˜„!!
# í˜„ì¬ shape
# ì´ë¯¸ì§€ ê°œìˆ˜, height, width, color ì´í˜•ì‹ìœ¼ë¡œ convolution ì…ë ¥ìœ¼ë¡œ ë„£ì–´ìš”
</span>
<span class="n">input_image</span> <span class="o">=</span> <span class="n">ori_img</span><span class="p">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)</span><span class="o">+</span> <span class="n">ori_img</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'input_image shape : {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">input_image</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">input_image</span> <span class="o">=</span> <span class="n">input_image</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="c1"># ì •ìˆ˜í˜• ndarrayë¥¼ ì‹¤ìˆ˜í˜•ìœ¼ë¡œ ë³€í™˜
</span>
<span class="c1"># ì…ë ¥ì´ë¯¸ì§€ì˜ color ìˆ˜ë¥¼ ë³€ê²½ &gt; channelì„ 1ë¡œ ë³€ê²½
</span><span class="n">input_image</span> <span class="o">=</span> <span class="n">input_image</span><span class="p">[:,:,:,:</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'ë³€ê²½ëœ input_image shape : {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">input_image</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>

<span class="c1"># filterë¥¼ ì¤€ë¹„í•´ì•¼ í•´ìš”!
# filter : (height, width, color, filter ê°œìˆ˜)
# filterëŠ” ì •ë°©í˜• ì¤‘ì— 3X3ì„ ë§ì´ ì‚¬ìš©!
# filter : (3,3,1,1)
</span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[[</span><span class="mi">0</span><span class="p">]],[[</span><span class="mi">1</span><span class="p">]]],</span>
                  <span class="p">[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[[</span><span class="mi">0</span><span class="p">]],[[</span><span class="mi">1</span><span class="p">]]],</span>
                  <span class="p">[[[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[[</span><span class="mi">0</span><span class="p">]],[[</span><span class="mi">1</span><span class="p">]]]])</span>

<span class="k">print</span><span class="p">(</span><span class="n">weight</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">con2d</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span>
                    <span class="n">weight</span><span class="p">,</span>
                    <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">con2d</span><span class="p">)</span> <span class="c1"># relu ê°€ ì•ˆë“¤ì–´ê°€ ìˆì–´ìš”!
</span><span class="k">print</span><span class="p">(</span><span class="s">'ê²°ê³¼ ë°ì´í„°ì˜ shape : {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">t_image</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span>
<span class="k">print</span><span class="p">(</span><span class="n">t_image</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">t_image</span><span class="p">)</span>


<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">pool_process</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">max_pool</span><span class="p">(</span><span class="n">result</span><span class="p">,</span>  
                              <span class="n">ksize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">strides</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">padding</span><span class="o">=</span><span class="s">'VALID'</span><span class="p">)</span>
<span class="n">pool_result</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">pool_process</span><span class="p">)</span>
<span class="n">pool_image</span> <span class="o">=</span> <span class="n">pool_result</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:,:]</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> 
<span class="n">ax3</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pool_image</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="ê²°ê³¼">ê²°ê³¼</h4>

<p align="center"><img src="../../assets/image/0785F1F2-9AE8-47F0-B8E7-2CE4FFD4E53C.png" alt="img" style="zoom:150%;" /></p>
:ET